<?xml version="1.0"?>
<odoo>
    <data>
        <record id="paperformat_sale_report" model="report.paperformat">
            <field name="name">Danfse</field>
            <field name="default" eval="True" />
            <field name="orientation">Portrait</field>
            <field name="margin_top">3</field>
            <field name="margin_bottom">3</field>
            <field name="margin_left">3</field>
            <field name="margin_right">3</field>
            <field name="header_line" eval="False" />
            <field name="header_spacing">3</field>
        </record>
        <report id="report_br_nfse_danfe_dsf" string="Nota de Serviço - DSF" model="invoice.eletronic" report_type="qweb-pdf" file="br_nfse.main_template_br_nfse_danfe_dsf" name="br_nfse.main_template_br_nfse_danfe_dsf" />
        <template id="danfse_report_template_dsf">
            <t t-call="web.html_container">
                <style type="text/css">     .col-xs-1, .col-xs-2,     .col-xs-3,.col-xs-4,.col-xs-5, .col-xs-6, .col-xs-7,     .col-xs-8,     .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12 {     padding:0px;     }     td, th     { padding: 0 4px; }    </style>
                <t t-foreach="docs" t-as="o">
                    <t t-set="doc" t-value="o" />
                    <div class="page">
                        <div class="row" style="border: 1px solid black;">
                            <div class="col-xs-2">
                                <img t-att-src="'/br_nfse/static/src/img/prefeitura-' + doc.company_id.city_id.name + '.jpg'" t-att-alt="'Logo Prefeitura de ' + doc.company_id.city_id.name" style="max-height:80px; margin-top:4px; margin-left:10px;" />
                            </div>
                            <div class="col-xs-8" style="padding:0px;text-align:center;font-size:18px;">        Prefeitura Municipal de <t t-esc="doc.company_id.city_id.name"></t>
                                <br />        Secretaria Municipal de Finanças
                                <br />
                                <t t-if="doc.state == 'nfse_ready'">
                                    <strong style="font-size:20px;">RECIBO PROVISÓRIO DE SERVIÇOS - RPS         </strong>
                                </t>
                                <t t-if="(doc.state == 'open' or doc.state == 'paid')">
                                    <strong style="font-size:20px;">NOTA FISCAL ELETRÔNICA DE SERVIÇOS - NFSe         </strong>
                                </t>
                            </div>
                            <div class="col-xs-2" style="padding:0px;">
                                <div style="border: 1px solid black; padding: 2px;">
                                    <t t-if="(doc.state == 'open' or doc.state == 'paid')">
                                        <span style="font-size:9px;">Número NFSe</span>
                                        <br />
                                        <strong t-field="doc.internal_number"></strong>
                                    </t>
                                    <t t-if="doc.state == 'nfse_ready'">
                                        <span style="font-size:9px;">Número RPS</span>
                                        <br />
                                        <strong t-field="doc.number"></strong>
                                    </t>
                                </div>
                                <div style="border: 1px solid black; padding: 2px;">
                                    <span style="font-size:9px;">Data de Emissão</span>
                                    <br />
                                    <strong t-field="doc.data_emissao" t-options='{"format": "MM/yyyy"}'></strong>
                                </div>
                                <t t-if="(doc.state == 'open' or doc.state == 'paid')">
                                    <div style="border: 1px solid black; padding: 2px;">
                                        <span style="font-size:8px;">Código de verificação</span>
                                        <br />
                                        <strong t-field="doc.verify_code"></strong>
                                    </div>
                                </t>
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid black; padding: 0 0 5px 5px;">
                            <div class="col-xs-12" style="text-align:center;">
                                <strong>PRESTADOR DE SERVIÇOS</strong>
                            </div>
                            <div class="col-xs-12">        Nome/Razão Social:
                                <strong t-field="doc.company_id.partner_id.legal_name"></strong>
                            </div>
                            <div class="col-xs-8">        CNPJ:
                                <strong t-field="doc.company_id.partner_id.cnpj_cpf"></strong>
                            </div>
                            <div class="col-xs-4">        Inscrição Municipal:
                                <strong t-field="doc.company_id.partner_id.inscr_mun"></strong>
                            </div>
                            <div class="col-xs-12">        Endereço:
                                <strong t-field="doc.company_id.partner_id.street"></strong>
                                <strong t-field="doc.company_id.partner_id.number"></strong>
                                <strong t-field="doc.company_id.partner_id.district"></strong>
                            </div>
                            <div class="col-xs-6">        Município:
                                <strong t-field="doc.company_id.partner_id.city_id.name"></strong>
                            </div>
                            <div class="col-xs-6">        UF:
                                <strong t-field="doc.company_id.partner_id.state_id.name"></strong>
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid black;padding: 0 0 5px 5px;">
                            <div class="col-xs-12" style="text-align:center;">
                                <strong>TOMADOR DE SERVIÇOS</strong>
                            </div>
                            <div class="col-xs-12">        Nome/Razão Social:
                                <strong t-field="doc.partner_id.legal_name"></strong>
                            </div>
                            <div class="col-xs-8">        CNPJ:
                                <strong t-field="doc.partner_id.cnpj_cpf"></strong>
                            </div>
                            <div class="col-xs-4">        Inscrição Municipal:
                                <strong t-field="doc.partner_id.inscr_mun"></strong>
                            </div>
                            <div class="col-xs-12">        Endereço:
                                <strong t-field="doc.partner_id.street"></strong>
                                <strong t-field="doc.partner_id.number"></strong>
                                <strong t-field="doc.partner_id.district"></strong>
                            </div>
                            <div class="col-xs-4">        Município:
                                <strong t-field="doc.partner_id.city_id.name"></strong>
                            </div>
                            <div class="col-xs-2">        UF:
                                <strong t-field="doc.partner_id.state_id.name"></strong>
                            </div>
                            <div class="col-xs-6">        E-mail:
                                <strong t-field="doc.partner_id.email"></strong>
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid black;padding: 0 0 5px 5px;">
                            <div class="col-xs-12" style="text-align:center;">
                                <strong>DISCRIMINAÇÃO DOS SERVIÇOS</strong>
                                <br />
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid black;min-height:150px; padding:0 0 5px 5px;">
                            <t t-foreach="doc.eletronic_item_ids" t-as="line">
                                <p t-field="line.name"></p>
                            </t>
                            <span t-field="doc.informacoes_legais"></span>
                            <span t-field="doc.informacoes_complementares"></span>
                        </div>
                        <div class="row" style="border: 1px solid black;min-height:380px; padding:0;">
                            <table style="width:100%;" border="1">
                                <thead>
                                    <tr>
                                        <th style="width:60%;">Item</th>
                                        <th style="width:10%;">Quantidade</th>
                                        <th style="width:15%;">Valor Unitário</th>
                                        <th style="width:15%;">Valor Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="doc.eletronic_item_ids" t-as="line">
                                        <td>
                                            <span t-field="line.product_id.name"></span>
                                        </td>
                                        <td>
                                            <span t-field="line.quantidade"></span>
                                        </td>
                                        <td>
                                            <span t-field="line.preco_unitario"></span>
                                        </td>
                                        <td>
                                            <span t-field="line.valor_bruto"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row" style="border: 1px solid black; padding:0 0 5px 5px;">
                            <div class="col-xs-2" style="width:20%;text-align:center;">                    INSS(
                                <span />%):
                                <br />
                                <t t-if="doc.company_id.fiscal_type == '3'">
                                    <strong t-field="doc.valor_retencao_inss" t-options='{"widget": "monetary",  "display_currency": doc.currency_id }'></strong>
                                </t>
                                <t t-if="doc.company_id.fiscal_type != '3'">
                                    <strong>-</strong>
                                </t>
                            </div>
                            <div class="col-xs-2" style="width:20%;text-align:center;">                    IR(
                                <span />%):
                                <br />
                                <t t-if="doc.company_id.fiscal_type == '3'">
                                    <strong t-field="doc.valor_retencao_irrf" t-options='{"widget": "monetary",  "display_currency": doc.currency_id }'></strong>
                                </t>
                                <t t-if="doc.company_id.fiscal_type != '3'">
                                    <strong>-</strong>
                                </t>
                            </div>
                            <div class="col-xs-2" style="width:20%;text-align:center;">                    CSLL(
                                <span />%):
                                <br />
                                <t t-if="doc.company_id.fiscal_type == '3'">
                                    <strong t-field="doc.valor_retencao_csll" t-options='{"widget": "monetary",  "display_currency": doc.currency_id }'></strong>
                                </t>
                                <t t-if="doc.company_id.fiscal_type != '3'">
                                    <strong>-</strong>
                                </t>
                            </div>
                            <div class="col-xs-2" style="width:20%;text-align:center;">                    COFINS(
                                <span t-field="doc.eletronic_item_ids[0].cofins_aliquota" />%):
                                <br />
                                <t t-if="doc.company_id.fiscal_type == '3'">
                                    <strong t-field="doc.valor_cofins_servicos" t-options='{"widget": "monetary",  "display_currency": doc.currency_id }'></strong>
                                </t>
                                <t t-if="doc.company_id.fiscal_type != '3'">
                                    <strong>-</strong>
                                </t>
                            </div>
                            <div class="col-xs-2" style="width:20%;text-align:center;border">                    PIS(
                                <span t-field="doc.eletronic_item_ids[0].pis_aliquota" />%):
                                <br />
                                <t t-if="doc.company_id.fiscal_type == '3'">
                                    <strong t-field="doc.valor_pis_servicos" t-options='{"widget": "monetary",  "display_currency": doc.currency_id }'></strong>
                                </t>
                                <t t-if="doc.company_id.fiscal_type != '3'">
                                    <strong>-</strong>
                                </t>
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid black;padding:0 0 5px 5px;">
                            <div class="col-xs-3" style="text-align:center;">        VL. Total Deduções:
                                <br />
                                <strong>R$0,00</strong>
                            </div>
                            <div class="col-xs-3" style="text-align:center;">        Base de Cálculo:
                                <br />
                                <strong t-field="doc.valor_bruto" t-options='{"widget": "monetary",  "display_currency": doc.currency_id }'></strong>
                            </div>
                            <div class="col-xs-3" style="text-align:center;">        Alíquota:
                                <br />
                                <strong>
                                    <span t-field="doc.eletronic_item_ids[0].issqn_aliquota" />%
                                </strong>
                            </div>
                            <div class="col-xs-3" style="text-align:center;">        Valor do ISS:
                                <br />
                                <strong>
                                    <span t-field="doc.eletronic_item_ids[0].issqn_valor" />
                                </strong>
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid black;padding:0 0 5px 5px;">
                            <div class="col-xs-4" style="text-align:center;font-size:20px;">        Valor RPS:
                                <strong t-field="doc.valor_servicos" t-field-options='{"widget": "monetary",  "display_currency": "doc.currency_id" }'></strong>
                            </div>
                            <div class="col-xs-4" style="text-align:center;">        Retenções:
                                <t t-set="retencoes" t-value='doc.valor_retencao_cofins + doc.valor_retencao_pis + doc.valor_retencao_csll + doc.valor_retencao_inss + doc.valor_retencao_irrf + doc.valor_retencao_issqn' />
                                <strong t-field='doc.currency_id.symbol'></strong>
                                <strong t-esc="'{0:,.2f}'.format(int(retencoes))"></strong>
                            </div>
                            <div class="col-xs-4" style="text-align:center;font-size:20px;">        Valor a Pagar:
                                <strong t-field="doc.valor_final" t-field-options='{"widget": "monetary",  "display_currency": "doc.currency_id" }'></strong>
                            </div>
                        </div>
                        <div class="row" style="border: 1px solid black;min-height:170px; padding:0 0 5px 5px;">
                            <div style="text-align:center">
                                <b>Outras informações</b>
                            </div>
                            <div style="float:left; width:50%;">        Mês de competência da nota fiscal:
                                <span t-field="doc.data_emissao" t-field-options='{"format": "MM/yyyy"}' />
                            </div>
                            <div style="float:left; width:50%;">        Local da prestação do Serviço:
                                <span t-field="doc.company_id.city_id" /> -
                                <span t-field="doc.company_id.state_id.code" />
                            </div>
                            <div style="float:left; width:50%;">        Recolhimento:
                                <span t-field="doc.type_retention" />
                            </div>
                            <div style="float:left; width:50%;">        Tributação:
                                <span t-field="doc.taxation" />
                            </div>
                            <div>
                                <span t-field="doc.eletronic_item_ids[0].codigo_tributacao_municipio" /> -
                                <span t-field="doc.eletronic_item_ids[0].product_id.service_type_id.name" />
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </template>
        <template id="main_template_br_nfse_danfe_dsf">
            <div class="article">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="br_nfse.danfse_report_template_dsf" t-lang="doc.partner_id.lang"/></t>
            </div>
        </template>
    </data>
</odoo>
